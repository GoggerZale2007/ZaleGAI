<!DOCTYPE html>
<html>
<head>
    <title>ZaleGAI 1.0</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: -apple-system, sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background: #eee; }
        #chat { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px 15px; border-radius: 18px; max-width: 80%; word-wrap: break-word; }
        .user { align-self: flex-end; background: #007bff; color: white; }
        .bot { align-self: flex-start; background: #ddd; color: black; }
        .input-area { padding: 15px; background: white; display: flex; gap: 10px; }
        input { flex: 1; padding: 12px; border: 1px solid #ccc; border-radius: 25px; outline: none; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 25px; font-weight: bold; }
    </style> /* Settings Button */
.settings-btn { position: absolute; top: 15px; right: 15px; font-size: 20px; cursor: pointer; background: none; border: none; }

/* The Modal (Pop-up) */
.modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
.modal-content { background: white; margin: 20% auto; padding: 20px; width: 85%; border-radius: 15px; }
.modal-content h2 { margin-top: 0; font-size: 1.2rem; }
.setting-item { margin-bottom: 15px; }
.setting-item label { display: block; font-size: 14px; margin-bottom: 5px; color: #666; }
.setting-item input, .setting-item textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; }

/* Dark Mode Helper */
body.dark-mode { background: #121212; color: white; }
body.dark-mode .modal-content { background: #1e1e1e; color: white; }
body.dark-mode .input-area, body.dark-mode header { background: #1e1e1e; border-color: #333; }
body.dark-mode input { color: white; }
</head>   
<body>

    <header id="mainHeader">ZaleGAI 1.0</header>

    <button class="settings-btn" onclick="toggleModal()">⚙️</button>

    <div id="chat">
        <div class="msg bot">Hello! I am ZaleGAI 1.0. How can I help you today?</div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <h2>ZaleGAI Settings</h2>
            <div class="setting-item">
                <label>Assistant Name</label>
                <input type="text" id="setBotName" placeholder="ZaleGAI 1.0">
            </div>
            <div class="setting-item">
                <label>System Instructions</label>
                <textarea id="setSystemPrompt" rows="3">You are ZaleGAI, a helpful assistant.</textarea>
            </div>
            <button onclick="saveSettings()" style="width:100%; border-radius:10px; background: black; color: white; padding: 10px;">Save & Close</button>
        </div>
    </div>

</body>
    
<body>
    <div id="chat"></div>
    <div class="input-area">
        <input type="text" id="userInput" placeholder="Ask me anything...">
        <button onclick="askAI()">Send</button>
    </div>

    <script>
        const API_KEY = "AIzaSyAvlWnUtHb8BvtJBaRFUTZF9ah85HFP_Ag"; // PASTE YOUR KEY HERE
        const chat = document.getElementById('chat');

        async function askAI() {
            const input = document.getElementById('userInput');
            const text = input.value.trim();
            if (!text) return;

            // Show User Message
            addMessage(text, 'user');
            input.value = '';

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: text }] }] })
                });

                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;
                addMessage(aiResponse, 'bot');
            } catch (error) {
                addMessage("Oops! Something went wrong. Check your API key.", 'bot');
            }
        }

        function addMessage(text, sender) {
            const div = document.createElement('div');
            div.className = `msg ${sender}`;
            div.innerText = text;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }
    </script> // 1. Initialize the history array outside the function
let chatHistory = []; 

async function askAI() {
    const input = document.getElementById('userInput');
    const text = input.value.trim();
    if (!text) return;

    // 2. Add User Message to UI
    addMessage(text, 'user');
    
    // 3. Add User Message to memory (History)
    chatHistory.push({
        role: "user",
        parts: [{ text: text }]
    });

    input.value = '';
    typingIndicator.style.display = 'block';
    chat.scrollTop = chat.scrollHeight;

    try {
        // 4. Send the ENTIRE history to the API
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                contents: chatHistory,
                // This keeps your "ChatGPT" personality active
                systemInstruction: { parts: [{ text: systemPrompt }] }
            })
        });

        const data = await response.json();
        
        // Handle potential errors from API
        if (!data.candidates) throw new Error("Invalid API Response");

        const aiResponse = data.candidates[0].content.parts[0].text;

        // 5. Add the AI's response to memory so it remembers for next time
        chatHistory.push({
            role: "model",
            parts: [{ text: aiResponse }]
        });

        typingIndicator.style.display = 'none';
        addMessage(aiResponse, 'bot');
    } catch (error) {
        console.error(error);
        typingIndicator.style.display = 'none';
        addMessage("Memory Error: I forgot what we were talking about. Please check your API key.", 'bot');
    }
}
    
</body>
</html>
