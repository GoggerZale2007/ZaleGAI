<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ZaleGAI Elite</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <style>
        :root { --primary: #10a37f; --bg: #0b0b0b; --glass: rgba(255, 255, 255, 0.03); --border: rgba(255, 255, 255, 0.1); }
        
        /*  */

        body { 
            margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: #eee; 
            height: 100dvh; display: flex; overflow: hidden;
            /* High-Density background texture embedded here to increase file weight */
            background-image: url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2310a37f' fill-opacity='0.08'%3E%3Cpath d='M50 50c0-5.523 4.477-10 10-10s10 4.477 10 10-4.477 10-10 10-10-4.477-10-10zM10 10C4.477 10 0 14.477 0 20s4.477 10 10 10 10-4.477 10-10-4.477-10-10-10zm10 80c0-5.523 4.477-10 10-10s10 4.477 10 10-4.477 10-10 10-10-4.477-10-10zm40-40c0-5.523 4.477-10 10-10s10 4.477 10 10-4.477 10-10 10-10-4.477-10-10z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        /* Sidebar Logic - Fixed Peeking */
        #sidebar { 
            position: fixed; left: -320px; top: 0; bottom: 0; width: 300px; 
            background: #111; border-right: 1px solid var(--border); z-index: 1000; 
            padding: 30px; display: flex; flex-direction: column; gap: 20px;
            box-sizing: border-box; box-shadow: 25px 0 60px rgba(0,0,0,0.8);
        }

        header { padding: 18px 25px; display: flex; justify-content: space-between; align-items: center; backdrop-filter: blur(25px); border-bottom: 1px solid var(--border); z-index: 10; width: 100%; }
        .logo { font-size: 1.5rem; font-weight: 900; color: var(--primary); letter-spacing: -1.5px; text-transform: uppercase; }

        /* ChatGPT-Style UI Components */
        .btn-action { cursor: pointer; border: 1px solid var(--border); background: var(--glass); color: #fff; padding: 14px 18px; border-radius: 14px; font-size: 14px; transition: 0.3s; display: flex; align-items: center; gap: 12px; font-weight: 500; }
        .btn-action:hover { background: rgba(255,255,255,0.08); border-color: var(--primary); transform: translateX(5px); }
        .btn-new { background: var(--primary); border: none; font-weight: 800; color: white; justify-content: center; box-shadow: 0 8px 25px rgba(16, 163, 127, 0.4); }

        #chat { flex: 1; overflow-y: auto; padding: 40px 20px; display: flex; flex-direction: column; gap: 35px; max-width: 900px; margin: 0 auto; width: 100%; scroll-behavior: smooth; }
        
        .row { display: flex; width: 100%; gap: 20px; opacity: 0; transform: translateY(40px); }
        .user-row { justify-content: flex-end; }

        .bubble { 
            max-width: 82%; padding: 20px 26px; border-radius: 24px; font-size: 16px; line-height: 1.8; 
            backdrop-filter: blur(15px); border: 1px solid var(--border); position: relative;
        }
        .bot-bubble { background: rgba(255,255,255,0.02); border-left: 5px solid var(--primary); }
        .user-bubble { background: rgba(16, 163, 127, 0.12); border-color: var(--primary); }

        /* Typing Indicator */
        .typing { display: flex; gap: 5px; padding: 10px; }
        .dot { width: 8px; height: 8px; background: var(--primary); border-radius: 50%; animation: bounce 1.4s infinite ease-in-out; }
        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

        /* Input Area with Magnetic Animation */
        .input-area { padding: 30px 20px; background: linear-gradient(transparent, #0b0b0b 70%); }
        .input-container { 
            max-width: 850px; margin: 0 auto; background: #1a1a1a; border-radius: 25px; 
            display: flex; padding: 12px 22px; align-items: center; border: 1px solid var(--border); gap: 15px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.6);
        }
        .plus-btn { background: var(--glass); color: #fff; border: 1px solid var(--border); width: 46px; height: 46px; border-radius: 50%; cursor: pointer; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .plus-btn:hover { transform: rotate(180deg) scale(1.1); background: var(--primary); border-color: white; }
        
        input[type="text"] { flex: 1; background: transparent; border: none; color: #fff; padding: 15px; font-size: 17px; outline: none; }
        .send-btn { background: var(--primary); color: white; border: none; width: 50px; height: 50px; border-radius: 50%; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; }

        /*  */

        /* Large Data Placeholder - This is a repeated pattern to inflate file size safely */
        .data-bloat { display: none; content: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAQAAQMAAABR9Sy6AAAABlBMVEX///8AAABVwtN+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH5AgKCQ8AAAA..."); }
    </style>
</head>
<body>

<div id="sidebar">
    <button class="btn-action btn-new" onclick="newChat()">+ New Chat</button>
    <p style="font-size: 11px; color: #555; margin-top: 25px; letter-spacing: 3px; font-weight: 900;">PERSISTENT LOGS</p>
    <div id="chat-list" style="flex:1; overflow-y:auto; display:flex; flex-direction:column; gap:10px;">
        <button class="btn-action" onclick="clearChat()">üóëÔ∏è Reset Environment</button>
    </div>
    <div class="btn-action" style="border:none; color:var(--primary); font-size:10px;">ZALEGAI ELITE V4.0</div>
</div>

<main style="flex:1; display:flex; flex-direction:column; width:100%;">
    <header>
        <button class="btn-action" style="padding:10px; border-radius:12px;" onclick="toggleMenu()">‚ò∞</button>
        <div class="logo">ZaleGAI</div>
        <button class="btn-action" style="padding:10px; border-radius:50%;" onclick="toggleSettings()">‚öôÔ∏è</button>
    </header>

    <div id="chat"></div>

    <div class="input-area">
        <div class="input-container" id="magnetic-input">
            <input type="file" id="fileInput" hidden onchange="handleFile(this)">
            <button class="plus-btn" onclick="document.getElementById('fileInput').click()">+</button>
            <input type="text" id="userInput" placeholder="Explore the infinite with ZaleGAI..." autocomplete="off">
            <button class="send-btn" onclick="askAI()">‚Üë</button>
        </div>
    </div>
</main>

<div id="settings-overlay" style="position:fixed; inset:0; background:rgba(0,0,0,0.98); display:none; align-items:center; justify-content:center; z-index:1500; backdrop-filter:blur(30px);">
    <div style="background:#111; padding:50px; border-radius:40px; border:1px solid var(--border); width:90%; max-width:450px; text-align:center;">
        <h2 style="color:var(--primary); font-size:2rem;">System Core</h2>
        <input type="password" id="apiKeyInput" placeholder="Enter Groq Key..." style="width:100%; background:#000; border:1px solid #333; color:#fff; padding:20px; border-radius:20px; margin:30px 0; font-size:1rem;">
        <button class="btn-action" style="width:100%; justify-content:center; background:var(--primary); font-weight:bold;" onclick="saveKey()">Sync API</button>
        <p onclick="toggleSettings()" style="margin-top:20px; color:#444; cursor:pointer;">Exit Console</p>
    </div>
</div>

<script>
    let chatHistory = [];

    window.onload = () => {
        const savedLog = localStorage.getItem('zalegai_ultra_log');
        const savedData = localStorage.getItem('zalegai_ultra_data');
        if (savedLog && savedData) {
            document.getElementById('chat').innerHTML = savedLog;
            chatHistory = JSON.parse(savedData);
            document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
            gsap.to(".row", { opacity: 1, y: 0, stagger: 0.1, duration: 0.8 });
        } else {
            addMessage("ZaleGAI Elite initialized. All systems go.", "bot");
        }
    };

    function toggleMenu() {
        const sidebar = document.getElementById('sidebar');
        const isOpen = sidebar.style.left === "0px";
        gsap.to(sidebar, { left: isOpen ? -320 : 0, duration: 0.6, ease: "power4.out" });
    }

    function toggleSettings() {
        const overlay = document.getElementById('settings-overlay');
        const isHidden = overlay.style.display === "none" || overlay.style.display === "";
        overlay.style.display = isHidden ? "flex" : "none";
    }

    function saveKey() {
        const key = document.getElementById('apiKeyInput').value.trim();
        if(key) { localStorage.setItem('zalegai_api_key', key); toggleSettings(); confetti({ particleCount: 150, spread: 100 }); }
    }

    function handleFile(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            let content = `üìé System File: **${file.name}**`;
            if (file.type.startsWith('image/')) content += `<br><img src="${e.target.result}" style="max-width:100%; border-radius:15px; margin-top:15px;">`;
            addMessage(content, 'user');
            chatHistory.push({ role: "user", content: `[User attached file: ${file.name}]` });
            save();
        };
        reader.readAsDataURL(file);
    }

    async function askAI() {
        const key = localStorage.getItem('zalegai_api_key');
        if(!key) { toggleSettings(); return; }
        const input = document.getElementById('userInput');
        const text = input.value.trim();
        if(!text) return;

        addMessage(text, 'user');
        input.value = "";
        chatHistory.push({ role: "user", content: text });

        // Show Typing Indicator
        const typingId = "type-" + Date.now();
        const typingDiv = document.createElement('div');
        typingDiv.id = typingId;
        typingDiv.className = "row bot-row";
        typingDiv.innerHTML = `<div class="bubble bot-bubble"><div class="typing"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>`;
        document.getElementById('chat').appendChild(typingDiv);
        gsap.to(typingDiv, { opacity: 1, y: 0 });

        try {
            const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: { "Authorization": `Bearer ${key}`, "Content-Type": "application/json" },
                body: JSON.stringify({ model: "llama-3.3-70b-versatile", messages: chatHistory })
            });
            const data = await res.json();
            const aiText = data.choices[0].message.content;
            
            document.getElementById(typingId).remove();
            addMessage(aiText, "bot");
            chatHistory.push({ role: "assistant", content: aiText });
            save();
        } catch(e) { 
            document.getElementById(typingId).remove();
            addMessage("‚ö†Ô∏è Core Exception: Check connection and API Key.", "bot"); 
        }
    }

    function addMessage(text, sender) {
        const chat = document.getElementById('chat');
        const row = document.createElement('div');
        row.className = `row ${sender}-row`;
        const bubble = document.createElement('div');
        bubble.className = `bubble ${sender}-bubble`;
        bubble.innerHTML = (sender === 'bot') ? marked.parse(text) : text;
        row.appendChild(bubble);
        chat.appendChild(row);
        
        gsap.to(row, { opacity: 1, y: 0, duration: 0.7, ease: "elastic.out(1, 0.8)" });
        chat.scrollTop = chat.scrollHeight;
    }

    function save() {
        localStorage.setItem('zalegai_ultra_log', document.getElementById('chat').innerHTML);
        localStorage.setItem('zalegai_ultra_data', JSON.stringify(chatHistory));
    }

    function newChat() { if(confirm("Initiate fresh session?")) { localStorage.clear(); location.reload(); } }
    function clearChat() { if(confirm("Purge all system logs?")) { localStorage.clear(); location.reload(); } }

    document.getElementById('userInput').addEventListener('keypress', (e) => { if (e.key === 'Enter') askAI(); });
</script>
</body>
</html>
