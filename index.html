<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ZaleGAI Elite V6.0</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <style>
        :root { 
            --primary: #10a37f; --primary-hover: #1a7f64; --bg: #050505; 
            --sidebar-bg: #0a0a0a; --glass: rgba(255, 255, 255, 0.03); 
            --border: rgba(255, 255, 255, 0.08); --error: #ff4a4a; --text: #ececec;
        }

        /* RESET & CORE */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden;
            background: var(--bg); color: var(--text); font-family: 'Inter', system-ui, sans-serif;
        }

        /* --- SIDEBAR SYSTEM --- */
        #sidebar { 
            position: fixed; left: -320px; top: 0; bottom: 0; width: 300px; 
            background: var(--sidebar-bg); border-right: 1px solid var(--border); z-index: 1000; 
            display: flex; flex-direction: column; padding: 20px; transition: none;
        }
        .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; z-index: 999; backdrop-filter: blur(4px); }
        
        .menu-section { margin-bottom: 25px; }
        .menu-label { font-size: 11px; font-weight: 800; color: #555; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 12px; }
        
        .nav-item { 
            padding: 12px 15px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; 
            gap: 12px; font-size: 14px; transition: 0.2s; border: 1px solid transparent; margin-bottom: 4px;
        }
        .nav-item:hover { background: var(--glass); }
        .nav-item.active { background: rgba(16, 163, 127, 0.1); border-color: var(--primary); color: var(--primary); }
        
        .exit-btn { margin-top: auto; color: var(--error); border: 1px solid rgba(255,74,74,0.2); }
        .exit-btn:hover { background: rgba(255,74,74,0.1); }

        /* --- APP MAIN --- */
        .app-container { display: flex; flex-direction: column; height: 100dvh; width: 100vw; }
        header { 
            padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; 
            background: rgba(5,5,5,0.8); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border);
            padding-top: env(safe-area-inset-top);
        }

        #chat-container { 
            flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 24px;
            max-width: 850px; margin: 0 auto; width: 100%; overscroll-behavior-y: contain;
        }

        .bubble { max-width: 85%; padding: 16px 20px; border-radius: 18px; line-height: 1.6; font-size: 15px; }
        .bot-bubble { background: var(--glass); border: 1px solid var(--border); border-left: 4px solid var(--primary); }
        .user-bubble { background: var(--primary); color: white; align-self: flex-end; }

        /* --- VISUALIZER --- */
        .visualizer { display: none; height: 20px; align-items: center; gap: 3px; margin-left: 10px; }
        .visualizer.active { display: flex; }
        .bar { width: 3px; height: 100%; background: var(--primary); border-radius: 2px; }

        /* --- INPUT --- */
        .input-deck { padding: 20px; padding-bottom: calc(20px + env(safe-area-inset-bottom)); }
        .input-box { 
            max-width: 850px; margin: 0 auto; background: #151515; border-radius: 30px; 
            padding: 8px 12px; display: flex; align-items: center; gap: 10px; border: 1px solid var(--border);
        }
        input { flex: 1; background: transparent; border: none; color: #fff; padding: 10px; outline: none; font-size: 16px; }
        .btn-circle { width: 44px; height: 44px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
    </style>
</head>
<body>

<div class="sidebar-overlay" id="overlay" onclick="toggleMenu()"></div>

<aside id="sidebar">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
        <span style="font-weight:900; color:var(--primary); font-size:1.4rem;">ZALEGAI 6.0</span>
        <button onclick="toggleMenu()" style="background:none; border:none; color:#555; font-size:30px;">&times;</button>
    </div>

    <div class="menu-section">
        <p class="menu-label">Personalities</p>
        <div class="nav-item active" onclick="setPersona('Default', this)">üß† Balanced Assistant</div>
        <div class="nav-item" onclick="setPersona('Professional', this)">üíº Executive Architect</div>
        <div class="nav-item" onclick="setPersona('Creative', this)">üé≠ Storyteller Pro</div>
        <div class="nav-item" onclick="setPersona('Technical', this)">üíª Code Debugger</div>
    </div>

    <div class="menu-section">
        <p class="menu-label">Language Matrix</p>
        <select id="lang" style="width:100%; background:#111; color:#fff; border:1px solid var(--border); padding:12px; border-radius:8px;">
            <option value="English">English (US)</option>
            <option value="Spanish">Espa√±ol</option>
            <option value="French">Fran√ßais</option>
            <option value="Japanese">Êó•Êú¨Ë™û</option>
        </select>
    </div>

    <div class="menu-section">
        <p class="menu-label">History</p>
        <button class="nav-item" style="width:100%; background:var(--glass);" onclick="clearAll()">üóëÔ∏è Wipe Memories</button>
    </div>

    <button class="nav-item exit-btn" onclick="exitApp()">üö™ Exit ZaleGAI</button>
</aside>

<div class="app-container">
    <header>
        <button onclick="toggleMenu()" class="btn-circle" style="background:var(--glass); color:#fff;">‚ò∞</button>
        <div style="display:flex; align-items:center;">
            <span style="font-weight:900;">ELITE V6.0</span>
            <div class="visualizer" id="viz">
                <div class="bar"></div><div class="bar"></div><div class="bar"></div>
            </div>
        </div>
        <button onclick="toggleSettings()" class="btn-circle" style="background:var(--glass); color:#fff;">‚öôÔ∏è</button>
    </header>

    <div id="chat-container"></div>

    <div class="input-deck">
        <div class="input-box">
            <button class="btn-circle" id="mic" onclick="startVoice()" style="background:var(--glass); color:#fff;">üéôÔ∏è</button>
            <input type="text" id="msgInput" placeholder="How can I help you today?" autocomplete="off">
            <button class="btn-circle" onclick="sendMessage()" style="background:var(--primary); color:#fff;">‚Üë</button>
        </div>
    </div>
</div>

<script>
    let history = JSON.parse(localStorage.getItem('zalegai_v6_chat')) || [];
    let persona = "Balanced Assistant";
    let recognition;

    // --- RECOGNITION ---
    if('webkitSpeechRecognition' in window) {
        recognition = new webkitSpeechRecognition();
        recognition.onstart = () => { document.getElementById('viz').classList.add('active'); animeViz(); };
        recognition.onresult = (e) => { document.getElementById('msgInput').value = e.results[0][0].transcript; sendMessage(); };
        recognition.onend = () => document.getElementById('viz').classList.remove('active');
    }

    function animeViz() {
        gsap.to(".bar", { height: "100%", duration: 0.3, stagger: 0.1, repeat: -1, yoyo: true });
    }

    // --- LOGIC ---
    window.onload = () => {
        history.forEach(m => render(m.content, m.role));
        if(!history.length) render("ZaleGAI Elite V6.0 online. **Memory persistent.** Language: **Universal.**", "bot");
    };

    function setPersona(p, el) {
        persona = p;
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        toggleMenu();
        render(`Persona shifted to **${p}**.`, "bot");
    }

    async function sendMessage() {
        const key = localStorage.getItem('zalegai_api_key');
        if(!key) return alert("System Offline: API Key Required.");
        const input = document.getElementById('msgInput');
        const text = input.value.trim();
        if(!text) return;

        render(text, 'user');
        input.value = "";
        
        const lang = document.getElementById('lang').value;
        const systemPrompt = `You are ${persona}. Always respond in ${lang}. Be professional and helpful.`;
        
        history.push({role: "user", content: text});
        save();

        try {
            const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: { "Authorization": `Bearer ${key}`, "Content-Type": "application/json" },
                body: JSON.stringify({ model: "llama-3.3-70b-versatile", messages: [{role: "system", content: systemPrompt}, ...history] })
            });
            const data = await res.json();
            const reply = data.choices[0].message.content;
            render(reply, 'bot');
            history.push({role: "assistant", content: reply});
            save();
        } catch(e) { render("‚ö†Ô∏è Neural Link Interrupted.", "bot"); }
    }

    function render(txt, role) {
        const chat = document.getElementById('chat-container');
        const div = document.createElement('div');
        div.className = `bubble ${role}-bubble`;
        div.innerHTML = role === 'bot' ? marked.parse(txt) : txt;
        chat.appendChild(div);
        gsap.from(div, { opacity: 0, y: 20, duration: 0.4 });
        chat.scrollTop = chat.scrollHeight;
    }

    function toggleMenu() {
        const side = document.getElementById('sidebar');
        const open = side.style.left === "0px";
        gsap.to(side, { left: open ? -320 : 0, duration: 0.5, ease: "power2.out" });
        document.getElementById('overlay').style.display = open ? "none" : "block";
    }

    function save() { localStorage.setItem('zalegai_v6_chat', JSON.stringify(history.slice(-20))); }
    function clearAll() { localStorage.clear(); location.reload(); }
    function exitApp() { if(confirm("Terminate session?")) { window.close(); document.body.innerHTML = "SYSTEM TERMINATED"; } }
    function startVoice() { recognition.start(); }
    function toggleSettings() { const k = prompt("Enter API Key:"); if(k) localStorage.setItem('zalegai_api_key', k); }
</script>
</body>
</html>
