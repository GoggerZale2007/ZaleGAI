<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ZaleGAI 1.0</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --bg: #212121; --sidebar: #171717; --text: #ececec;
            --user-msg: #303030; --bot-msg: transparent; --accent: #10a37f;
        }
        
        body { 
            margin: 0; font-family: 'Sentry', -apple-system, sans-serif; 
            background: var(--bg); color: var(--text); 
            height: 100dvh; display: flex; flex-direction: column;
        }

        /* ChatGPT Header Style */
        header { 
            padding: 10px 15px; display: flex; justify-content: space-between; 
            align-items: center; background: var(--bg); font-weight: 600; font-size: 18px;
        }

        /* Chat Window - Centered like GPT-4 */
        #chat { 
            flex: 1; overflow-y: auto; display: flex; flex-direction: column;
            width: 100%; max-width: 800px; margin: 0 auto; padding-bottom: 100px;
        }

        .row { width: 100%; padding: 20px 15px; display: flex; gap: 15px; animation: fadeIn 0.3s ease; }
        .row.user-row { background: transparent; justify-content: flex-end; }
        
        /* Message Bubbles */
        .msg { max-width: 80%; line-height: 1.6; font-size: 16px; word-wrap: break-word; }
        .user-msg-box { 
            background: var(--user-msg); padding: 10px 20px; 
            border-radius: 25px; color: #fff; 
        }

        /* Typing Cursor Animation */
        .typing::after {
            content: "●"; animation: blink 0.8s infinite;
            margin-left: 5px; color: var(--accent);
        }
        @keyframes blink { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Floating Input Bar */
        .input-area { 
            position: fixed; bottom: 0; left: 0; right: 0;
            background: linear-gradient(transparent, var(--bg) 30%);
            padding: 20px 15px calc(20px + env(safe-area-inset-bottom));
        }

        .input-container {
            max-width: 780px; margin: 0 auto; background: var(--user-msg);
            border-radius: 30px; display: flex; align-items: center;
            padding: 8px 15px; border: 1px solid #444;
        }

        input {
            flex: 1; background: transparent; border: none; color: #fff;
            padding: 10px; font-size: 16px; outline: none;
        }

        .send-btn {
            background: var(--accent); color: white; border: none;
            width: 35px; height: 35px; border-radius: 50%;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: opacity 0.2s;
        }
        .send-btn:disabled { opacity: 0.3; }

        .set-btn { background: none; border: 1px solid #555; color: #aaa; border-radius: 5px; padding: 4px 8px; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <span>ZaleGAI</span>
    <button class="set-btn" onclick="setKey()">API Key</button>
</header>

<div id="chat">
    <div class="row">
        <div class="msg">Hello. How can I help you today?</div>
    </div>
</div>

<div class="input-area">
    <div class="input-container">
        <input type="text" id="userInput" placeholder="Message ZaleGAI..." autocomplete="off">
        <button class="send-btn" id="sendBtn" onclick="askAI()">↑</button>
    </div>
</div>

<script>
    let API_KEY = localStorage.getItem('zalegai_groq_key') || "";
    let chatHistory = [];
    let isTyping = false;

    function setKey() {
        const key = prompt("Paste your Groq API Key (gsk_...):", API_KEY);
        if (key) {
            API_KEY = key.trim();
            localStorage.setItem('zalegai_groq_key', API_KEY);
        }
    }

    function addRow(sender) {
        const chat = document.getElementById('chat');
        const row = document.createElement('div');
        row.className = sender === 'user' ? 'row user-row' : 'row';
        
        const msgDiv = document.createElement('div');
        msgDiv.className = sender === 'user' ? 'msg user-msg-box' : 'msg typing';
        
        row.appendChild(msgDiv);
        chat.appendChild(row);
        chat.scrollTop = chat.scrollHeight;
        return msgDiv;
    }

    // ChatGPT word-by-word animation
    async function typeWriter(element, text) {
        const words = text.split(" ");
        element.innerHTML = "";
        for (let i = 0; i < words.length; i++) {
            element.innerHTML += words[i] + " ";
            document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
            await new Promise(r => setTimeout(r, 40)); // Speed of typing
        }
        element.classList.remove('typing');
        // Final render to parse Markdown
        element.innerHTML = marked.parse(text);
    }

    async function askAI() {
        const inp = document.getElementById('userInput');
        const btn = document.getElementById('sendBtn');
        const text = inp.value.trim();

        if (!text || !API_KEY || isTyping) return;

        isTyping = true;
        btn.disabled = true;
        
        // User Message
        const userBox = addRow('user');
        userBox.textContent = text;
        inp.value = "";
        
        chatHistory.push({ role: "user", content: text });

        // Bot Row (Empty at first)
        const botBox = addRow('bot');

        try {
            const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${API_KEY}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    model: "llama-3.3-70b-versatile",
                    messages: chatHistory
                })
            });

            const data = await response.json();
            const aiText = data.choices[0].message.content;
            
            await typeWriter(botBox, aiText);
            chatHistory.push({ role: "assistant", content: aiText });

        } catch (e) {
            botBox.innerHTML = "<span style='color:red'>Connection Error. Check Key/VPN.</span>";
            botBox.classList.remove('typing');
        } finally {
            isTyping = false;
            btn.disabled = false;
        }
    }

    document.getElementById('userInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') askAI();
    });
</script>
</body>
</html>
